

### 通信协议部分

#### USART / UART（通用同步/异步收发器）

##### **概念**

- USART（Universal Synchronous/Asynchronous Receiver Transmitter）
  - **异步或同步**全双工串行通信
- UART 是 USART 的异步模式

 | 特性     | 描述                                                      |
   | -------- | ---------------------------------------------------------  |
   | 数据线   | TXD / RXD（双向全双工）                                   |
   | 数据格式 | 一次传输 1 字节（8 位），可选检验位（奇偶校验）           |
   | 波特率   | 每秒发送的位数，决定通信速率                              |
   | 发送顺序 | **先低位（LSB）→高位（MSB）**                             |
   | 异步机制 | 每次只发 1 字节，依靠波特率控制发送时序，避免累计时间误差 |

##### 数据帧格式

![usart数据位](.\img\usart数据位.png)

- **起始位**：1 位，固定为 `0`（低电平），表示传输开始
- **数据位**：5~9 位，常用 8 位，**低位在前 (LSB → MSB)**
- **校验位**：可选（奇/偶校验）
- **停止位**：1、1.5 或 2 位，固定为 `1`（高电平）



#### iic通信

##### **概念**

- 串行同步、半双工总线
- 两根线：SDA（数据）、SCL（时钟）
- 常用于低速、近距离芯片间通信

##### 特点

| 特性         | 描述                                          |
| ------------ | --------------------------------------------- |
| 数据传输方向 | 半双工                                        |
| 同步机制     | SCL 控制数据采样，SDA 在 SCL 低电平时修改数据 |
| 地址寻址     | 每个设备有唯一地址                            |
| 时序         | 起始信号、停止信号、应答信号、数据传输        |
| 位顺序       | **先高位（MSB）→低位（LSB）**                 |

##### **通信流程**

1. 主机发起起始信号

2. 主机发送目标设备地址 + 读/写位

3. 设备应答（ACK）

4. 数据传输（主机/从机交替）

5. 主机发停止信号，释放总线

##### 写时序

   1. 开始信号
   2. 发送从机地址位
   3. 写控制位
   4. 等待从机ACK应答
   5. 再次发送开始信号
   6. 发送写入寄存器的地址
   7. 等待从机ACK应答
   8. 发送写入的数据
   9. 等待从机ACK应答
   10. 停止信号

##### 读时序

1. 开始信号
2. 发送从机地址位
3. 写控制位
4. 等待从机ACK应答
5. 重新发送开始信号
6. 发送读取寄存器的地址
7. 等待从机ACK应答
8. 重新发送开始信号
9. 发送从机地址位
10. 读控制位
11. 等待从机ACK应答
12. 从机发送寄存器数据
13. 主机发送NACK信号，表示读取完成
14. 主机发送结束信号
15. 数据帧格式

![时序图](.\img\时序图.png)

1. **开始信号**

   SCL高电平期间，SDA从高电平切换到低电平

2. **结束信号**

   SCL高电平期间，SDA从低电平切换到高电平

3. **应答信号**

   主机在接收完一个字节之后，在下一个时钟发送一位数据，数据0表示应答，数据1表示非应答

4. **数据有效性**

   只有当SCL为高电频的时候 SDA的数据才是有效数据，并且SDA这时候不能改变数据，只有当SCL为低电平的时候，SDA才允许改变状态

5. **数据传输**(8bits)

6. **空闲状态**

SCL和SDA都为高电平

#### spi通信

#####  概念

- 全双工、同步串行通信
- 至少四条线：MOSI、MISO、SCLK、CS

##### 特点

| 特性         | 描述                                        |
| ------------ | ------------------------------------------- |
| 数据传输方向 | 全双工                                      |
| 同步机制     | SCLK 时钟同步                               |
| 时序         | 上升沿/下降沿触发（CPOL/CPHA 配置四种模式） |
| 位顺序       | **先高位→低位**                             |
| 应答机制     | 无（连续发送数据即可）                      |
| 地址寻址     | 片选线 CS 控制选择设备                      |

##### 通信流程

主机选择片选 CS

主机发送/接收数据（MOSI/MISO）

SCLK 控制数据采样与发送

数据传输完成后释放 CS



#### USB

##### 概念

- 串行通信总线，用于计算机与外设间高速通信
- 支持热插拔、即插即用

##### 特点

| 特性         | 描述                                 |
| ------------ | ------------------------------------ |
| 数据传输方式 | 全双工或半双工，分包传输             |
| 拓扑结构     | 主机-设备（Hub）结构                 |
| 电气特性     | 差分信号，抗干扰强                   |
| 协议层次     | 分为物理层、链路层、传输层、应用层   |
| 数据单位     | 包（Packet）                         |
| 速率         | 从低速（1.5 Mbps）到超高速（5 Gbps） |

#### CAN（Controller Area Network）

##### 概念

多主机、高可靠性串行通信总线，常用于汽车和工业控制

##### 特点

| 特性         | 描述                                           |
| ------------ | ---------------------------------------------- |
| 数据传输方向 | 半双工                                         |
| 同步机制     | 同步位 + 时钟同步                              |
| 抗干扰       | 高（差分信号 + CRC 校验）                      |
| 错误检测     | 位错误、填充错误、CRC 错误、格式错误、ACK 错误 |
| 总线结构     | 多节点并联，广播机制                           |



#### 总结

| 协议       | 线路数 | 双工/半双工 | 同步/异步 | 地址/寻址    | 应用场景            |
| ---------- | ------ | ----------- | --------- | ------------ | ------------------- |
| UART/USART | 2      | 全双工      | 异步      | 无（点对点） | 单片机、RS232/RS485 |
| I²C        | 2      | 半双工      | 同步      | 地址寻址     | 近距离芯片间通信    |
| SPI        | ≥4     | 全双工      | 同步      | CS片选       | 高速芯片间通信      |
| USB        | 4      | 半/全双工   | 异步      | 包传输       | 外设-主机通信       |
| CAN        | 2      | 半双工      | 同步      | 广播/标识符  | 汽车、工业控制      |

### 硬件外设

#### GPIO

