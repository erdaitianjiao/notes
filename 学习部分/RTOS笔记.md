## RTOS(Real Time OS):实时操作系统

#### 一、RTOS 的特点

> - 实时操作系统特点 强调**实时性**
>   1. **分而治之** 实现功能分为多个任务
>   
>   2. **延时函数** 任务调度
>   
>   3. **抢占式** 高任务优先级抢占低优先级任务
>   
>   4. **任务堆栈** 每个任务有自己的栈空间
>   
>      注意：中断可以打断任意任务
>   

#### 二、FreeRTOS

> - 是一个免费的嵌入式实时操作系统
>   1. 免费开源
>   2. **可裁剪** 核心代码9000行
>   3. **优先级不限** 任务分配优先级没有限制，多任务可以同一优先级
>   4. **任务不限** 
>   5. **抢占/协程/时间片** 支持抢占式、协程式、时间片流转任务调度
>
> - 资料整理
>
>    1. [FreeRTO官网](https://www.freertos.org/) 多是英文 文档较少
>    2. 点原子资料：教程文档 程序源码 视频资料
>
>    >  [!Note]
>    >
>    > 后面学习设计到 ARM-Cortex-M 架构的知识参考《Cortex M3权威指南》《Cortex M3与M4权威指南》
>    >
>    > - M4比M3更多的支持fpu（浮点运算）
>
> - 关于FreeRTOS 学习资料
>
>    1. Freetos基础知识：了解任务调度器、以及RTOS的特性
>    2. FreeRTOS内核： 任务启动流程，中断管理、任务切换
>    3. FreeRTOS各功能：列表、队列、信号量、内存管理...
>

#### 三、 FreeFTOS基础知识

> 1. **任务调度简介**
>
>    调度器就是使用相关的调度算法来决定当前需要执行那个任务
>
>    *FreeRTOS 一共支持三种调度方式：*
>
>    - 抢占式调度
>
>      >主要是针对优先级不同的任务，每一个任务都有一个优先级，优先级高的任务可以抢占低优先级的任务
>
>    - 时间片调度
>
>      > 主要针对优先级相同的任务，当多个任务的优先级相同时，任务调度器会在每一次系统时钟节拍到的时候切换任务
>
>    - 协程式调度
>
>      > 当前执行任务会一直运行，同时高优先级的任务不会抢占低优先级的任务(但是不会再更新)
>
>   2. 抢占式调度
>
>      - 运行条件
>
>        > 1. 创建三个任务,Task1,Task2,Task3
>        > 2.  Task1,Task2,Task3的优先级分别为1、2、3；在FreeRTOS中设置的数值越大、优先级越高，所以Task3的优先级最高
>
>       - 运行过程
>
>      	 > 1. 首先在Task1在运行中，在这个过程中，Task2过程中就绪了，在抢占式调度器的作用下Task2会抢占Task1的运行
>      	 > 2. 首先在Task2在运行中，在这个过程中，Task3过程中就绪了，在抢占式调度器的作用下Task3会抢占Task2的运行
>      	 > 3. 在Task3在运行中，Task3阻塞了（系统延时等待信号量等），此时就绪态中，优先级最高的是任务Task2执行
>      	 > 4. Task3阻塞解除了（延时到了或者接收到到信号量），此时Task3恢复到就绪状态中，抢占Task2运行
>
>      	 > [!CAUTION]
>      	 >
>      	 > 1. 高优先级任务，优先执行
>      	 > 2. 高优先级任务不停止，低优先任务无法执行
>      	 > 3. 被抢占的任务会进入就绪状态
>
>   3. 时间片调度
>
>      - **同等级优先任务** 轮流地享有相同的CPU时间（**可设置**），叫时间片，在FreeRTOS中，**一个时间片就等于SysTick中断周期**
>
>      - 运行条件
>
>        >1. 创建三个任务：Task1、Task2、Task3
>        >2. Task1、Task2、Task3的优先级均为1；即3个任务等同优先级
>
>      - 运行过程
>
>        > 1. 首先Task1运行完一个时间片后，切换至Task2运行
>        > 2. Task2运行完一个时间片后，切换至Task3运行
>        > 3. Task3运行过程中（还不到一个时间片），Task3阻塞了（系统延时或者等待信号量等），这时切换至Task1执行
>        > 4. Task1运行完一个时间片后，切换至Task2运行
>
>        > [!CAUTION]
>        >
>        > 1. 同等优先级任务，轮流执行；时间片流转
>        > 2. 一个时间片大小，取决于滴答定时器中断周期
>        > 3. 注意没用用完的时间片不会再使用，下次任务Task3得到执行的时候还是按照一个时间片的时钟节拍运行
>
>   4. **任务状态（熟悉）**
>
> 	- FreeRTOS 中任务共存在4中状态：
> 		1. **运行态**：正在运行的任务，该任务就处于运行状态，注意在STM32中，同一时间仅一个任务处于运行状态
> 		1. **就绪态**：如果该任务已经能够被执行，但当前还未被执行，那么该任务就被称为就绪态
> 		1. **阻塞态**：如果一个任务因为延时或等待等待外部事件发生，那么这个任务就处于阻塞态
> 		1.  **挂起态**：类似暂停，调用函数vTaskSuspend()进入挂起态，需要解挂解vTaskResume()才可以进入就绪状态
>
>      - 任务转换图
>
> 		![转换](F:\workspace\computer_science_relative\typora\pic\转换.png)
> 	
> 5. **任务状态**
>
> 	>[!NOTE]
> 	  >
> 	  >1.FreeRTOS中无非就四种状态，运行态，就绪态、阻塞态、挂起态
> 	  >
> 	  >2.这四种状态中，除了运行态，其他三种任务状态的任务都有其对应的任务状态**列表**
>
> 	  > - 就绪列表：pxReadyTaskLists[X] 其中x代表人物优先级指数
> 	  > - 阻塞列表：pxDelayedTaskList
> 	  > - 挂起列表：xSuspendedTaskList
>
> 

